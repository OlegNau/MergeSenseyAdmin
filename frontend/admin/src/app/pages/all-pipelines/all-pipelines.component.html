<div class="min-h-screen bg-gray-50">
  <div class="max-w-6xl mx-auto p-4 sm:p-6">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold page-title">All Pipelines</h1>
    </div>

    <div class="flex flex-col sm:flex-row gap-3 sm:items-center mb-4">
      <div class="relative flex-1">
        <input
          [ngModel]="query()"
          (ngModelChange)="query.set($event)"
          type="text"
          placeholder="Search pipelines..."
          class="w-full border border-gray-200 rounded-md px-3 py-2 pl-9 bg-white"
        />
        <svg class="w-4 h-4 absolute left-3 top-2.5 text-gray-400" viewBox="0 0 24 24" fill="none">
          <path
            d="M15.5 14h-.79l-.28-.27A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28.79.79L20 20.5 21.5 19l-6-6z"
            fill="currentColor"
          />
        </svg>
      </div>

      <select
        [ngModel]="status()"
        (ngModelChange)="status.set($event)"
        class="border border-gray-200 rounded-md px-3 py-2 bg-white"
      >
        <option value="all">All statuses</option>
        <option value="idle">Idle</option>
        <option value="running">Running</option>
        <option value="success">Success</option>
        <option value="failed">Failed</option>
      </select>

      <select
        [ngModel]="sort()"
        (ngModelChange)="sort.set($event)"
        class="border border-gray-200 rounded-md px-3 py-2 bg-white"
      >
        <option value="updated">Sort by: Updated</option>
        <option value="name">Sort by: Name</option>
      </select>
    </div>

    <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="text-left py-3 px-6 font-medium text-gray-600">Name</th>
              <th class="text-left py-3 px-6 font-medium text-gray-600">Project</th>
              <th class="text-left py-3 px-6 font-medium text-gray-600">Status</th>
              <th class="text-left py-3 px-6 font-medium text-gray-600">Updated</th>
              <th class="text-right py-3 px-6 font-medium text-gray-600">Actions</th>
            </tr>
          </thead>
          <tbody>
            @if (filtered().length) {
              @for (p of filtered(); track trackById) {
                <tr class="border-t border-gray-100 hover:bg-gray-50">
                  <td class="py-3 px-6 text-gray-900">
                    <button class="text-blue-600 hover:underline" (click)="openPipeline(p.id)">{{ p.name }}</button>
                  </td>
                  <td class="py-3 px-6 text-gray-700">
                    @if (p.project) {
                      <button class="text-blue-600 hover:underline" (click)="openProject(p.project!)">{{ p.project }}</button>
                    } @else {
                      <span class="text-gray-400">—</span>
                    }
                  </td>
                  <td class="py-3 px-6">
                    @if (p.status === 'running') {
                      <span class="text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-700">Running</span>
                    }
                    @if (p.status === 'success') {
                      <span class="text-xs px-2 py-0.5 rounded-full bg-green-50 text-green-700">Success</span>
                    }
                    @if (p.status === 'failed') {
                      <span class="text-xs px-2 py-0.5 rounded-full bg-red-50 text-red-700">Failed</span>
                    }
                    @if (p.status === 'idle' || !p.status) {
                      <span class="text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-600">Idle</span>
                    }
                  </td>
                  <td class="py-3 px-6 text-gray-600">{{ p.updatedAt || '—' }}</td>
                  <td class="py-3 px-6 text-right">
                    <button
                      (click)="runPipeline(p.id)"
                      class="inline-flex items-center gap-2 rounded-full px-3 py-1.5 border border-gray-200 hover:bg-white"
                    >
                      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none">
                        <path d="M8 5v14l11-7-11-7z" fill="currentColor" />
                      </svg>
                      <span>Run</span>
                    </button>
                  </td>
                </tr>
              }
            } @else {
              <tr class="border-t border-gray-100">
                <td colspan="5" class="py-6 px-6 text-sm text-gray-500">No pipelines found.</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
