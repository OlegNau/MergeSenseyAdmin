<div class="space-y-6">
  <div>
    <h1 class="text-3xl font-bold title" data-testid="text-help-title">Help &amp; Support</h1>
    <p class="mt-1 subtitle" data-testid="text-help-subtitle">
      Get help and support for your questions
    </p>
  </div>

  <div class="space-y-6">
    <div class="grid w-full grid-cols-2">
      <button
        class="flex items-center justify-center p-2"
        [ngClass]="activeTab === 'faq' ? 'border-b-2 font-semibold' : 'border-b'"
        (click)="setActiveTab('faq')"
        data-testid="tab-faq"
      >
        <svg
          class="w-4 h-4 mr-2"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="m21 21-4.34-4.34" />
          <circle cx="11" cy="11" r="8" />
        </svg>
        FAQ
      </button>

      <button
        class="flex items-center justify-center p-2"
        [ngClass]="activeTab === 'chat' ? 'border-b-2 font-semibold' : 'border-b'"
        (click)="setActiveTab('chat')"
        data-testid="tab-chat"
      >
        <svg
          class="w-4 h-4 mr-2"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719" />
        </svg>
        AI Assistant
      </button>
    </div>

    @if (activeTab === 'faq') {
      <div class="bg-white rounded-lg shadow-md" data-testid="card-faq">
        <div class="p-6 border-b">
          <h2 class="text-lg font-semibold">Frequently Asked Questions</h2>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            @for (item of faqItems; track item.id) {
              <div
                class="border rounded-lg"
                [attr.data-testid]="'faq-item-' + item.id"
              >
                <button
                  class="w-full p-4 text-left flex items-center justify-between hover:bg-gray-100 transition-colors"
                  (click)="toggleFaq(item.id)"
                  [attr.data-testid]="'faq-question-' + item.id"
                  [attr.aria-expanded]="expandedFaq === item.id"
                >
                  <span class="font-medium">{{ item.question }}</span>
                  @if (expandedFaq === item.id) {
                    <svg
                      class="w-5 h-5 text-gray-500"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      aria-hidden="true"
                    >
                      <path d="m6 9 6 6 6-6" />
                    </svg>
                  } @else {
                    <svg
                      class="w-5 h-5 text-gray-500"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      aria-hidden="true"
                    >
                      <path d="m9 18 6-6-6-6" />
                    </svg>
                  }
                </button>

                @if (expandedFaq === item.id) {
                  <div
                    class="p-4 border-t faq-answer"
                    [attr.data-testid]="'faq-answer-' + item.id"
                  >
                    <p class="muted-text">{{ item.answer }}</p>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </div>
    }

    @if (activeTab === 'chat') {
      <div class="bg-white rounded-lg shadow-md" data-testid="card-ai-chat">
        <div class="p-6 border-b">
          <h2 class="text-lg font-semibold flex items-center">
            <svg
              class="w-5 h-5 mr-2"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M12 8V4H8" />
              <rect width="16" height="12" x="4" y="8" rx="2" />
              <path d="M2 14h2" />
              <path d="M20 14h2" />
              <path d="M15 13v2" />
              <path d="M9 13v2" />
            </svg>
            AI Assistant
          </h2>
        </div>

        <div class="p-6">
          <div class="space-y-4">
            <div
              class="h-96 border rounded-lg p-4 overflow-y-auto space-y-4"
              data-testid="chat-messages"
              role="log"
              aria-live="polite"
            >
              @for (message of chatMessages; track message.id) {
                <div
                  class="flex"
                  [class.justify-end]="message.type === 'user'"
                  [class.justify-start]="message.type === 'bot'"
                  [attr.data-testid]="'chat-message-' + message.id"
                >
                  <div
                    class="max-w-xs lg:max-w-md px-4 py-2 rounded-lg"
                    [ngClass]="message.type === 'user' ? 'user-msg' : 'bot-msg'"
                  >
                    <p class="text-sm">{{ message.message }}</p>
                    <p class="text-xs mt-1 timestamp">
                      {{ message.timestamp | date: 'shortTime' }}
                    </p>
                  </div>
                </div>
              }
            </div>

            <div class="flex space-x-2">
              <textarea
                [(ngModel)]="chatInput"
                placeholder="Ask me anything about pipelines, projects, or platform features..."
                class="flex-1 min-h-[60px] resize-none p-2 rounded-md border"
                (keydown)="onKeyDown($event)"
                data-testid="textarea-chat-input"
                aria-label="Message to AI assistant"
              ></textarea>

              <button
                class="px-4 py-2 rounded-md send-btn"
                (click)="handleSendMessage()"
                [disabled]="!chatInput.trim()"
                data-testid="button-send-message"
              >
                <svg
                  class="w-4 h-4"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true"
                >
                  <path d="M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z" />
                  <path d="m21.854 2.147-10.94 10.939" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
